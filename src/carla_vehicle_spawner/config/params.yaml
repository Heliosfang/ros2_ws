carla_vehicle_spawner:
  ros__parameters:
    spectator_smooth_tau_pos: 0.15
    spectator_smooth_tau_yaw: 0.20
    spectator_follow_lag_sec: 0.10       # increase for more trailing feel
    spectator_yaw_lookahead_sec: 0.15    # increase to look further into turns

    carla_map: "Town05"
    vehicle_blueprint: "vehicle.lincoln.mkz_2017"

    # fixed spawn (example: by index)
    spawn_mode: "index"     # "index" or "pose"
    spawn_index: 0

    # spectator in vehicle frame
    spectator_offset_x: -10.0
    spectator_offset_z: 3.0

    # 2D LiDAR
    lidar_range: 30.0
    lidar_upper_fov: 0.0
    lidar_lower_fov: 0.0
    lidar_points_per_second: 200000
    lidar_rotation_frequency: 10.0
    lidar_dropoff_general_rate: 0.0
    lidar_dropoff_intensity_limit: 1.0
    lidar_dropoff_zero_intensity: 0.0

    # camera
    enable_camera: true
    camera_width: 800
    camera_height: 600
    camera_fov: 90.0
    camera_sensor_tick: 0.0

carla_odom_publisher:
  ros__parameters:
    host: "127.0.0.1"
    port: 2000
    rate_hz: 20.0

    # selection precedence: actor_id > role_name > blueprint
    vehicle_actor_id: 0
    vehicle_role_name: "ego"                 # set to "ego" if you tag the vehicle
    vehicle_blueprint: "vehicle.lincoln.mkz_2017"
    vehicle_blueprint_index: 0

carla_vehicle_controller:
  ros__parameters:
    host: "127.0.0.1"
    port: 2000

    # Vehicle selection precedence: actor_id > role_name > blueprint
    vehicle_actor_id: 0
    vehicle_role_name: "ego"
    vehicle_blueprint: "vehicle.lincoln.mkz"
    vehicle_blueprint_index: 0

    # Accel→throttle/brake mapping (used if control_cmd_mode == "steer_accel")
    accel_to_throttle_gain: 0.25
    accel_to_brake_gain: 0.30
    deadband_accel: 0.05

    # Steering normalization & slew limit
    steer_saturation: 1.0
    steer_rate_limit: 2.0
    max_steer_angle_rad: 1.222        # steer_rad / this → steer_norm in [-1,1]

    # How to interpret /control_cmd data=[steer_rad, second, brake]:
    #  - "steer_throttle": second = throttle in [0,1] (default)
    #  - "steer_accel":    second = accel in m/s^2 (mapped to throttle/brake)
    control_cmd_mode: "steer_throttle"

    # Vehicle resolution
    resolve_period_sec: 0.5
    log_every_n_resolves: 10

    # === NEW: velocity PID control ===
    velocity_cmd_topic: "/velocity_cmd"   # Float32MultiArray: [velocity_mps, steer_rad, brake_binary]

    speed_pid_kp: 0.8
    speed_pid_ki: 0.2
    speed_pid_kd: 0.05
    speed_pid_i_max: 0.5                  # integral clamp
    speed_pid_throttle_max: 1.0           # throttle clamp
    speed_pid_alpha: 0.2                  # EMA smoothing for measured speed
